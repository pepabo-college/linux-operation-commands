# `sar`

- System Admin Reporter
- サーバの CPU, メモリ、IO など様々な情報を取得する
- cron でサーバ情報の履歴を保存している
  - `/etc/cron.d/sysstat` に cron 定義あり
  - `/etc/sysconfig/sysstat` の `HISTORY` で保存日数を設定する

## 実行例

```
Linux 3.10.0-327.36.1.el7.x86_64 (monitoring)   2016年10月24日  _x86_64_        (1 CPU)

05時40分01秒     CPU     %user     %nice   %system   %iowait    %steal     %idle
05時50分01秒     all      0.03      0.00      0.10      0.00      0.00     99.87
06時00分01秒     all      0.06      0.00      0.12      0.01      0.00     99.81
06時10分01秒     all      0.02      0.00      0.09      0.00      0.00     99.89
06時20分01秒     all      0.01      0.00      0.07      0.00      0.00     99.92
06時30分01秒     all      0.01      0.00      0.07      0.00      0.00     99.91
06時40分01秒     all      0.02      0.00      0.10      0.00      0.00     99.88
06時50分01秒     all      0.01      0.00      0.08      0.00      0.00     99.91
...
```

## 基本コマンド

- まずはインストール
  - `yum install sysstat`

- `sar`
  - 過去の CPU 全体の情報が出る

- 出力情報
  - user
    - ユーザが利用している割合
    - 上昇していると特定ユーザで CPU が消費されている可能性あり
      - `ps` でチェック
  - nice
    - nice 値を変更しているプロセスが利用している割合
      - プロセスの nice 値を上げると、CPU 割当の優先順位が上がる
  - system
    - カーネルが利用している割合
    - 上昇しているとコンテキストスイッチが頻発している可能性あり
  - iowait
    - IO 待ちになっている割合
    - 上昇しているとスラッシングや大きなファイルのコピーが発生している可能性あり
  - steal
    - ゲスト OS が割当要求したが割り当ててもらえなかった割合
  - idle
    - なにもしていない待機状態の割合

## オプション

- `-u`
  - CPU 全体の情報を表示
- `-u -P ALL`
  - マルチコア CPU の場合にコアごとの情報を表示
- `sar <オプション> <時間間隔> <表示時間>`
  - `<表示時間>` のあいだ、`<時間間隔>` ごとに表示する
- `-s <開始時間> -e <終了時間> -f <ログファイルのパス>`
  - 過去のログ確認
  - 当月 1 日の 15:00 〜 18:00 のデータを見たいときは次のコマンドを実行
  - `sar -u -s 15:00:00 -d 18:00:00 -f /var/log/sysstat/sa01`

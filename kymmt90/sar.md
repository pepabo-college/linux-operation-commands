# `sar`

- System Admin Reporter
- サーバの CPU, メモリ、IO など様々な情報を取得する
- cron でサーバ情報の履歴を保存している
  - `/etc/cron.d/sysstat` に cron 定義あり
  - `/etc/sysconfig/sysstat` の `HISTORY` で保存日数を設定する

## 基本コマンド

- まずはインストール
  - `yum install sysstat`

- `sar`
  - 過去 1 時間の CPU 全体の情報が出る

- 出力情報
  - user
    - ユーザが利用している割合
    - 上昇していると特定ユーザで CPU が消費されている可能性あり
      - `ps` でチェック
  - nice
    - nice 値を変更しているプロセスが利用している割合
      - プロセスの nice 値を上げると、CPU 割当の優先順位が上がる
  - system
    - カーネルが利用している割合
    - 上昇しているとコンテキストスイッチが頻発している可能性あり
  - iowait
    - IO 待ちになっている割合
    - 上昇しているとスラッシングや大きなファイルのコピーが発生している可能性あり
  - steal
    - ゲスト OS が割当要求したが割り当ててもらえなかった割合
  - idle
    - なにもしていない待機状態の割合

## オプション

- `-u`
  - CPU 全体の情報を表示
- `-u -P ALL`
  - マルチコア CPU の場合にコアごとの情報を表示
- `sar <オプション> <時間間隔> <表示時間>`
  - `<表示時間>` のあいだ、`<時間間隔>` ごとに表示する
- `-s <時間> -f <ログファイルのパス>`
  - ログ確認
  - 当月 1 日の 15:00 以降のデータを見たいときは次のコマンドを実行
  - `sar -u -s 15:00:00 -f /var/log/sysstat/sa01`
